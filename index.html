<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Climate Analysis Tool — Realistic Earth</title>
<style>
  *{margin:0;padding:0;box-sizing:border-box}
  body{
    font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
    background:radial-gradient(ellipse at bottom,#0b132b 0%,#000 100%);
    min-height:100vh;overflow:hidden;display:flex;justify-content:center;
    align-items:center;flex-direction:column;color:#fff}
  #loading{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
           color:rgba(255,255,255,.85);font-size:1.1rem;animation:pulse 1.5s infinite;text-align:center}
  @keyframes pulse{0%,100%{opacity:.35}50%{opacity:1}}
  .btn{position:absolute;bottom:70px;background:linear-gradient(135deg,#007cf0 0%,#00dfd8 100%);
       color:#fff;border:0;padding:16px 60px;border-radius:40px;font-weight:600;text-decoration:none;
       box-shadow:0 10px 40px rgba(0,223,216,.5)}
  .credit{position:absolute;bottom:14px;font-size:12px;color:rgba(255,255,255,.6)}
</style>
</head>
<body>
<div id="loading">Loading Earth…<br/><small>If this stays, your network may block CDNs.</small></div>
<canvas id="earthCanvas"></canvas>
<a class="btn" href="https://YOUR_CLOUDFLARE_URL_HERE/guacamole" target="_blank">Launch Tool</a>
<div class="credit">Textures © NASA Earth Observatory • Powered by Three.js</div>

<!-- Load Three.js from two CDNs, then OrbitControls. Classic scripts, not modules. -->
<script src="https://cdn.jsdelivr.net/npm/three@0.164/build/three.min.js"
        onerror="var s=document.createElement('script');s.src='https://unpkg.com/three@0.164.0/build/three.min.js';document.head.appendChild(s);"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.164/examples/js/controls/OrbitControls.min.js"
        onerror="var s=document.createElement('script');s.src='https://unpkg.com/three@0.164.0/examples/js/controls/OrbitControls.min.js';document.head.appendChild(s);"></script>

<script>
(function boot(){
  // Wait for THREE and OrbitControls to exist
  function ready(){ return !!(window.THREE && THREE.OrbitControls); }
  function startWhenReady(){
    if(!ready()) return setTimeout(startWhenReady, 120);
    start();
  }
  startWhenReady();

  function start(){
    const loading = document.getElementById('loading');
    const canvas  = document.getElementById('earthCanvas');
    const scene   = new THREE.Scene();
    const camera  = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 2000);
    camera.position.set(0, 0.4, 2.6);

    const renderer = new THREE.WebGLRenderer({canvas, antialias:true});
    renderer.setSize(innerWidth, innerHeight);
    renderer.setPixelRatio(Math.min(devicePixelRatio, 2));

    const loader = new THREE.TextureLoader();
    const done = () => loading?.remove();
    const fail = e => { console.error('Texture load error', e); loading.textContent='Texture load error. Check network.'; };

    const texColor = loader.load("https://cdn.jsdelivr.net/gh/rajtilakjee/earth-globe-textures@main/earthmap4k.jpg", done, undefined, fail);
    const texBump  = loader.load("https://cdn.jsdelivr.net/gh/rajtilakjee/earth-globe-textures@main/earthbump.jpg", undefined, undefined, fail);
    const texSpec  = loader.load("https://cdn.jsdelivr.net/gh/rajtilakjee/earth-globe-textures@main/earthspec.jpg", undefined, undefined, fail);
    const texCloud = loader.load("https://cdn.jsdelivr.net/gh/rajtilakjee/earth-globe-textures@main/earthcloudmaptrans.jpg", undefined, undefined, fail);
    const texNight = loader.load("https://cdn.jsdelivr.net/gh/rajtilakjee/earth-globe-textures@main/earthlights.jpg", undefined, undefined, fail);

    const earth = new THREE.Mesh(
      new THREE.SphereGeometry(1, 96, 96),
      new THREE.MeshPhongMaterial({ map: texColor, bumpMap: texBump, bumpScale: 0.045,
        specularMap: texSpec, specular: new THREE.Color('grey'), shininess: 10 })
    );
    scene.add(earth);

    const night = new THREE.Mesh(
      new THREE.SphereGeometry(1.001, 96, 96),
      new THREE.MeshBasicMaterial({ map: texNight, transparent:true, opacity:0.6, blending:THREE.AdditiveBlending })
    );
    scene.add(night);

    const clouds = new THREE.Mesh(
      new THREE.SphereGeometry(1.01, 96, 96),
      new THREE.MeshLambertMaterial({ map: texCloud, transparent:true, opacity:0.35, depthWrite:false })
    );
    scene.add(clouds);

    const atmosphere = new THREE.Mesh(
      new THREE.SphereGeometry(1.06, 96, 96),
      new THREE.MeshBasicMaterial({ color: 0x3aa8ff, transparent:true, opacity:0.18 })
    );
    scene.add(atmosphere);

    scene.add(new THREE.AmbientLight(0x222222));
    const sun = new THREE.DirectionalLight(0xffffff, 1.2);
    sun.position.set(5, 2, 5);
    scene.add(sun);

    // Starfield
    const g = new THREE.BufferGeometry(), pos = new Float32Array(6000*3);
    for (let i=0;i<6000;i++){ pos[i*3]=(Math.random()-.5)*2000; pos[i*3+1]=(Math.random()-.5)*2000; pos[i*3+2]=-Math.random()*2000; }
    g.setAttribute('position', new THREE.BufferAttribute(pos,3));
    scene.add(new THREE.Points(g, new THREE.PointsMaterial({ size:1, color:0xffffff })));

    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping=true; controls.enableZoom=false; controls.enablePan=false;
    controls.autoRotate=true; controls.autoRotateSpeed=0.35;

    addEventListener('resize', ()=>{
      camera.aspect=innerWidth/innerHeight; camera.updateProjectionMatrix();
      renderer.setSize(innerWidth, innerHeight);
    });

    const clock=new THREE.Clock();
    (function animate(){
      requestAnimationFrame(animate);
      const dt=clock.getDelta();
      clouds.rotation.y += dt*0.015;
      night.rotation.y = earth.rotation.y;
      controls.update();
      renderer.render(scene, camera);
    })();
  }
})();
</script>
</body>
</html>
